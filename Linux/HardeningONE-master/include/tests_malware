#!/bin/sh

#################################################################################
#
#   hardeningone
# ------------------
#
# Copyleft GPL3 2010-2011, Mauro Risonho de Paula Assumpção (mauro.risonho@gmail.com), 
# Web site: http://
#
# hardeningone comes with ABSOLUTELY NO WARRANTY. This is free software, and you are
# welcome to redistribute it under the terms of the GNU General Public License.
# See LICENSE file for usage of this software.
#
#################################################################################
#
# Malware scanners
#
#################################################################################
#
    InsertSection "" #31. Software: Scanners Malware"
#
#################################################################################
#
    CLAMD_RUNNING=0
    MALWARE_SCANNER_INSTALLED=0
#
#################################################################################
#
    # Test        : MALW-3275
    # Description : Check for installed tool (chkrootkit)
    Register --test-no MALW-3275 --weight L --network NO --description "" #Check for chkrootkit"
    if [ ${SKIPTEST} -eq 0 ]; then
        logtext "R-TEC-MALW-3275-Teste: Verificado presence chkrootkit"
        if [ ! "${CHKROOTKITBINARY}" = "" ]; then
    	    Display --indent 2 --text "" #- R-TEC-MALW-3275-Verificado chkrootkit..." --result "OK" --color GREEN
	    logtext "R-TEC-MALW-3275-Resultado: Found ${CHKROOTKITBINARY}"
	    MALWARE_SCANNER_INSTALLED=1
	    AddHP 2 2
          else
	    Display --indent 2 --text "" #- R-TEC-MALW-3275-Verificado chkrootkit..." --result "NAO OK" --color WHITE
	    logtext "R-TEC-MALW-3275-Resultado: chkrootkit not found"
        fi
    fi
#
#################################################################################
#
    # Test        : MALW-3276
    # Description : Check for installed tool (Rootkit Hunter) 
    Register --test-no MALW-3276 --weight L --network NO --description "" #Check for Rootkit Hunter"
    if [ ${SKIPTEST} -eq 0 ]; then
        logtext "R-TEC-MALW-3276-Teste: Verificado presence Rootkit Hunter"
	if [ ! "${RKHUNTERBINARY}" = "" ]; then
	    Display --indent 2 --text "" #- R-TEC-MALW-3276-Verificado Rootkit Hunter..." --result "OK" --color GREEN
	    logtext "R-TEC-MALW-3276-Resultado: Found ${RKHUNTERBINARY}"
	    MALWARE_SCANNER_INSTALLED=1
	    AddHP 2 2
          else
	    Display --indent 2 --text "" #- R-TEC-MALW-3276-Verificado Rootkit Hunter..." --result "NAO OK" --color WHITE
	    logtext "R-TEC-MALW-3276-Resultado: Rootkit Hunter not found"
	fi
    fi
#
#################################################################################
#
    # Test        : MALW-3282
    # Description : Check if clamscan is installed
    Register --test-no MALW-3282 --weight L --network NO --description "" #Check for clamscan"
    if [ ${SKIPTEST} -eq 0 ]; then
	logtext "R-TEC-MALW-3282-Teste: Verificado presence clamscan"
	if [ ! "${CLAMSCANBINARY}" = "" ]; then
	    Display --indent 2 --text "" #- R-TEC-MALW-3282-Verificado ClamAV scanner..." --result "OK" --color GREEN
	    logtext "R-TEC-MALW-3282-Resultado: Found ${CLAMSCANBINARY}"
	    MALWARE_SCANNER_INSTALLED=1
	    AddHP 2 2
	  else
	    Display --indent 2 --text "" #- R-TEC-MALW-3282-Verificado ClamAV scanner..." --result "NAO OK" --color WHITE
	    logtext "R-TEC-MALW-3282-Resultado: clamscan couldn't be found"
	fi
    fi
#
#################################################################################
#
    # Test        : MALW-3284
    # Description : Check running clamd process
    Register --test-no MALW-3284 --weight L --network NO --description "" #Check for clamd"
    if [ ${SKIPTEST} -eq 0 ]; then
	logtext "R-TEC-MALW-3284-Teste: Verificado running ClamAV daemon (clamd)"
	FIND=`${PSBINARY} ax | grep "/clamd" | grep -v "grep"`
	if [ ! "${FIND}" = "" ]; then
	    Display --indent 2 --text "" #- R-TEC-MALW-3284-Verificado ClamAV daemon..." --result "OK" --color GREEN
	    logtext "R-TEC-MALW-3284-Resultado: found running clamd process"
	    MALWARE_SCANNER_INSTALLED=1
	    CLAMD_RUNNING=1
	  else
	    Display --indent 2 --text "" #- R-TEC-MALW-3284-Verificado ClamAV daemon..." --result "NAO OK" --color WHITE
	    logtext "R-TEC-MALW-3284-Resultado: clamd not running"
	fi
    fi
#
#################################################################################
#
    # Test        : MALW-3286
    # Description : Check running freshclam if clamd process is running
    if [ ${CLAMD_RUNNING} -eq 1 ]; then PREQS_MET="YES"; else PREQS_MET="NO"; fi
    Register --test-no MALW-3286 --preqs-met ${PREQS_MET} --weight L --network NO --description "" #Check for freshclam"
    if [ ${SKIPTEST} -eq 0 ]; then
	logtext "R-TEC-MALW-3286-Teste: Verificado running freshclam daemon"
	FIND=`${PSBINARY} ax | grep "/freshclam" | grep -v "grep"`
	if [ ! "${FIND}" = "" ]; then
	    Display --indent 4 --text "" #- R-TEC-MALW-3286-Verificado freshclam..." --result "OK" --color GREEN
	    logtext "R-TEC-MALW-3286-Resultado: found running freshclam process"
	    AddHP 2 2
	  else
	    Display --indent 4 --text "" #- R-TEC-MALW-3286-Verificado freshclam..." --result "SUGESTAO" --color YELLOW
	    logtext "R-TEC-MALW-3286-Resultado: freshclam is not running"
	    ReportSuggestion ${TEST_NO} "R-TEC-MALW-3286-Confirm that freshclam is properly configured and keeps updating the ClamAV database"
	fi
    fi
#
#################################################################################
#
    # Test        : MALW-3292
    # Description : Check if at least one malware scanner is installed
#    Register --test-no MALW-3292 --weight L --network NO --description "" #Check for at least one malware scanner"
#    if [ ${SKIPTEST} -eq 0 ]; then
#	if [ ${MALWARE_SCANNER_INSTALLED} -eq 1 ]; then
#	    logtext "Resultado: At least one malware scanner is installed"
#	    Display --indent 2 --text "" #- Verificado presence malware scanner..." --result "OK" --color GREEN
#	    #AddHP 3 3
#	  else
#	    logtext "Resultado: No malware scanners found"
#	    Display --indent 2 --text "" #- Verificado presence malware scanner..." --result "NAO OK" --color YELLOW
#	    ReportSuggestion ${TEST_NO} "Install at least one malware scanner to perform periodic integrity tests on the system"
#	    #AddHP 0 3
#	fi
#    fi
#
#################################################################################
#
    
wait_for_keypress

#
#================================================================================
# hardeningone - Copyleft GPL3 2010-2011, Mauro Risonho de Paula Assumpção -  - 
